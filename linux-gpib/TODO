cleanup and improve organization of code

